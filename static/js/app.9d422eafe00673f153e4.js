webpackJsonp([1],{"23ZW":function(t,s){},BMZ2:function(t,s){},FAw5:function(t,s,e){t.exports=e.p+"static/img/default_hd.df7d40a.jpg"},NHnr:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("7+uW"),n=e("mvHQ"),i=e.n(n),r={name:"ChatItem",props:{id:String},data:function(){return{}},computed:{isCurrent:function(){return this.$store.state.currentChat.who==this.id},isHasNewMsg:function(){return this.$store.state.noRead.includes(String(this.id))}}},o={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"chat-item",class:{current:this.isCurrent}},[s("div",{staticClass:"avatar",class:{"new-msg":this.isHasNewMsg}},[s("img",{attrs:{src:e("FAw5")}})]),s("div",{staticClass:"name"},[this._t("default")],2)])},staticRenderFns:[]};var c={name:"App",components:{ChatItem:e("VU/8")(r,o,!1,function(t){e("23ZW")},"data-v-3aa62be8",null).exports},mounted:function(){var t=localStorage.user;t?(this.$store.state.user=JSON.parse(t),this.$store.commit("initConn",this.msgCallback),this.$store.state.mask=!1):this.$store.state.user.uid=Number(new Date)},computed:{activeUsers:function(){var t=this;return this.$store.state.userList.filter(function(s){return s.uid!=t.$store.state.user.uid})}},methods:{msgCallback:function(t){var s={sendobj:t.from,content:t.data,username:t.username,window:"all"==t.to?"all":t.from};this.$store.commit("addChatStorage",s),this.$store.commit("newMsg",s.window)},ok:function(){if(this.$store.state.user.username=this.$store.state.user.username.replace(/^\s*/g,"").replace(/\s*$/g,"").substr(0,8),""!=this.$store.state.user.username){var t={uid:this.$store.state.user.uid,username:this.$store.state.user.username};localStorage.user=i()(t),this.$store.commit("initConn",this.msgCallback),this.$store.state.mask=!1}},tapChat:function(t,s){this.$store.state.currentChat={who:t,name:s},this.$store.commit("deleteNewMsg",t)}}},u={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"app"}},[t.$store.state.mask?e("div",{attrs:{id:"mask"}},[e("div",{staticClass:"panel"},[e("div",[t._v("快帮自己取个名字吧。")]),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.$store.state.user.username,expression:"$store.state.user.username"}],attrs:{type:"text",maxlength:"6"},domProps:{value:t.$store.state.user.username},on:{input:function(s){s.target.composing||t.$set(t.$store.state.user,"username",s.target.value)}}})]),e("div",{staticClass:"ok"},[e("span",{on:{click:t.ok}},[t._v("确定")])])])]):t._e(),e("div",{staticClass:"main"},[e("div",{staticClass:"main-inner"},[e("div",{staticClass:"sd"},[e("div",{staticClass:"m-hd"},[e("div",{staticClass:"header"},[t._m(0),e("div",{staticClass:"info"},[e("div",{staticClass:"name"},[t._v(t._s(t.$store.state.user.username))]),t._m(1)])]),t._m(2),t._m(3)]),e("div",{staticClass:"m-lst-box topnav_box"},[e("div",{staticClass:"m-lst"},[[e("ChatItem",{attrs:{id:"all"},nativeOn:{click:function(s){t.tapChat("all","群聊")}}},[t._v("群聊")])],t._l(t.activeUsers,function(s){return[e("chat-item",{attrs:{id:s.uid},nativeOn:{click:function(e){t.tapChat(s.uid,s.username)}}},[t._v(t._s(s.username))])]})],2)])]),e("div",{staticClass:"chat-box"},[e("router-view")],1)])])])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"avatar"},[s("img",{attrs:{src:e("FAw5")}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"menu"},[s("i",{staticClass:"iconfont icon-menu"})])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"search"},[s("i",{staticClass:"iconfont icon-sousuo u-search"}),s("input",{attrs:{type:"text",placeholder:"搜索"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",{staticClass:"m-tab"},[s("li",{staticClass:"current"},[s("i",{staticClass:"iconfont icon-liaotian"})]),s("li",[s("i",{staticClass:"iconfont icon-yuedu"})]),s("li",[s("i",{staticClass:"iconfont icon-tongxunlu"})])])}]};var l=e("VU/8")(c,u,!1,function(t){e("jED4"),e("edsr")},"data-v-4bc5d492",null).exports,d=e("/ocq"),h=e("woOf"),m=e.n(h),v=e("Zrlr"),f=e.n(v),C=e("wxAW"),p=e.n(C),g={event:"msg",from:"",username:"",to:"all",type:"text",data:""},w=new(function(){function t(){f()(this,t),!1 in window&&alert("您的浏览器不支持 WebSocket!")}return p()(t,[{key:"open",value:function(t){try{this.wss=new WebSocket("ws://120.78.206.114:18081")}catch(t){alert("连接服务器失败")}t=m()(g,t),this.wss.onopen=function(){this.send(i()(t))}}},{key:"message",value:function(t){this.wss.onmessage=function(s){t(s.data)}}},{key:"send",value:function(t){t=m()(g,t),this.wss.send(i()(t))}}]),t}()),_={name:"ChatArea",data:function(){return{currentChatList:[]}},watch:{"$store.state.currentChat.who":{handler:function(t,s){this._resetCurrentChatStorage()}},"$store.state.isNeedPush":{handler:function(t,s){this._resetCurrentChatStorage()}}},computed:{who:function(){return this.$store.state.currentChat.who},whoName:function(){return this.$store.state.currentChat.name}},methods:{send:function(){var t=this.$refs.input.innerHTML;if(t=t.replace(/^\s*/g,"").replace(/\s*$/g,"").substr(0,200)){var s={to:this.who,data:t};this.$store.commit("send",s),this.$store.commit("addChatStorage",{content:t,sendobj:"me",username:this.$store.state.user.username,window:this.who}),this._resetCurrentChatStorage(),this.$refs.input.innerHTML=""}},_resetCurrentChatStorage:function(){var t=this,s=sessionStorage.historyChat&&JSON.parse(sessionStorage.historyChat)||{};this.currentChatList=s[this.who]?s[this.who]:[],setTimeout(function(){t.$refs.chatbox.scrollTop=t.$refs.chatbox.scrollHeight},10)}},mounted:function(){this._resetCurrentChatStorage()}},$={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"chat-area"},[a("div",{staticClass:"box-hd"},[a("div",{staticClass:"title"},[t._v(t._s(t.whoName))])]),a("div",{ref:"chatbox",staticClass:"chat-bd topnav_box"},[0==t.currentChatList.length?a("div",{staticClass:"empty"},[t._v("暂时没有新消息")]):t._e(),t._l(t.currentChatList,function(s){return["me"!=s.sendobj?a("div",{staticClass:"msg-item clearfix msg-item-left"},[a("div",{staticClass:"nt-item"},[a("img",{staticClass:"image",attrs:{src:e("FAw5")}}),a("div",["all"==t.who?a("div",{staticClass:"show-name"},[t._v(t._s(s.username))]):t._e(),a("div",{staticClass:"content",domProps:{innerHTML:t._s(s.content)}})])])]):a("div",{staticClass:"msg-item msg-item-right clearfix"},[a("div",{staticClass:"nt-item"},[a("div",{staticClass:"content",domProps:{innerHTML:t._s(s.content)}}),a("img",{staticClass:"image",attrs:{src:e("FAw5")}})])])]})],2),a("div",{staticClass:"m-ft"},[t._m(0),a("div",{staticClass:"content"},[a("div",{ref:"input",staticClass:"input",attrs:{contenteditable:"true"},on:{keyup:function(s){return("button"in s||!t._k(s.keyCode,"enter",13,s.key,"Enter"))&&s.ctrlKey?t.send(s):null}}})]),a("div",{staticClass:"action"},[a("span",{staticClass:"notice"},[t._v("按ctrl+enter发送")]),a("a",{staticClass:"u-send",attrs:{href:"javascript:void(0)"},on:{click:t.send}},[t._v("发送")])])])])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("ul",{staticClass:"tool-tab"},[s("li",[s("i",{staticClass:"iconfont icon-face"})]),s("li",[s("i",{staticClass:"iconfont icon-cut"})]),s("li",[s("i",{staticClass:"iconfont icon-file"})])])}]};var b=e("VU/8")(_,$,!1,function(t){e("BMZ2")},"data-v-00e956d5",null).exports;a.a.use(d.a);var S=new d.a({routes:[{path:"/",name:"ChatArea",component:b}]}),k=e("9rMa");a.a.use(k.a);var x=new k.a.Store({state:{user:{username:"",uid:""},userList:[],currentChat:{who:"all",name:"群聊"},mask:!0,isNeedPush:0,noRead:[]},getters:{},mutations:{initConn:function(t,s){var e={event:"reg",from:t.user.uid,username:t.user.username,to:"all",data:t.user.username+"上线啦"};w.open(e),w.message(function(e){"msg"==(e=JSON.parse(e)).event?s(e):"user"==e.event&&t.userList!=e.data&&(t.userList=e.data)})},send:function(t,s){var e={event:"msg",from:t.user.uid,username:t.user.username,to:"all",data:""};e=m()(e,s),w.send(e)},addChatStorage:function(t,s){var e=sessionStorage.historyChat&&JSON.parse(sessionStorage.historyChat)||{},a={sendobj:s.sendobj,content:s.content,username:s.username,window:s.window,date:Number(new Date)};e[a.window]||(e[a.window]=[]),e[a.window].push(a),sessionStorage.historyChat=i()(e)},newMsg:function(t,s){s==t.currentChat.who?t.isNeedPush++:t.noRead.includes(String(s))||t.noRead.push(String(s))},deleteNewMsg:function(t,s){s=String(s);var e=t.noRead.indexOf(s);e>-1&&t.noRead.splice(e,1)}},actions:{}});a.a.config.productionTip=!1,new a.a({el:"#app",store:x,router:S,components:{App:l},template:"<App/>"})},edsr:function(t,s){},jED4:function(t,s){}},["NHnr"]);
//# sourceMappingURL=app.9d422eafe00673f153e4.js.map